(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{634:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>S});var a=s(7876),l=s(4232),n=s(7328),i=s.n(n),r=s(4587),o=s.n(r),c=s(2711),d=s(4802),m=s(607),u=s(1514);let h=e=>{let{onStart:t}=e;return(0,a.jsx)("div",{className:"content-wrapper",children:(0,a.jsxs)("div",{className:"welcome-screen",children:[(0,a.jsxs)("div",{className:"welcome-text",children:[(0,a.jsx)("h1",{className:"welcome-title",children:"Financial Promotions Compliance Questionnaire"}),(0,a.jsx)("p",{className:"welcome-subtitle",children:"Navigate the complexities of financial promotions with confidence. This tool will guide you through the key regulatory checkpoints to help assess your compliance health."}),(0,a.jsxs)("button",{className:"start-button",onClick:t,children:[(0,a.jsx)(c.A,{className:"start-icon"}),"Start Questionnaire"]})]}),(0,a.jsxs)("div",{className:"welcome-features",children:[(0,a.jsx)("h3",{className:"features-title",children:"How It Works"}),(0,a.jsxs)("ul",{className:"features-list",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)(d.A,{className:"feature-icon"}),(0,a.jsx)("span",{children:"Answer a series of targeted questions based on FCA guidance."})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)(m.A,{className:"feature-icon"}),(0,a.jsx)("span",{children:"Receive an instant compliance health score and a detailed breakdown."})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)(u.A,{className:"feature-icon"}),(0,a.jsx)("span",{children:"Identify potential compliance gaps and access relevant regulatory references."})]})]})]})]})})},x=e=>{let{question:t,onAnswer:s,onNext:l,onPrev:n,isFirstQuestion:i,isLastQuestion:r,currentAnswer:o}=e,c=e=>{s(t.id,{answer:e.target.value,notes:(null==o?void 0:o.notes)||""})},d=e=>{let a,{value:l,checked:n}=e.target,i=Array.isArray(null==o?void 0:o.answer)?o.answer:[];a=n?[...i,l]:i.filter(e=>e!==l),s(t.id,{answer:a,notes:(null==o?void 0:o.notes)||""})};return(0,a.jsxs)("div",{className:"content-wrapper",children:[(0,a.jsxs)("div",{className:"layout-wrapper",children:[(0,a.jsx)("div",{className:"layout-main",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("h4",{className:"question-text",children:[t.id,". ",t.questionText]}),(0,a.jsxs)("p",{className:"text-sm text-slate-500 mb-6",children:["Reference: ",t.questionRef]}),(0,a.jsx)("div",{className:"answer-options mb-6",children:(()=>{let{type:e,options:s}=t,l=null==o?void 0:o.answer;return"yesno"===e?["Yes","No"].map(e=>(0,a.jsxs)("label",{className:"radio-label","data-checked":l===e,children:[(0,a.jsx)("input",{type:"radio",name:t.id,value:e,checked:l===e,onChange:c}),(0,a.jsx)("span",{children:e})]},e)):"dropdown"===e?Array.isArray(s)?(0,a.jsx)("select",{value:l||"",onChange:c,children:s.map(e=>(0,a.jsx)("option",{value:e.value,children:e.text},e.value))}):(0,a.jsx)("div",{className:"text-red-500",children:"Error: Dropdown options not available."}):"multiselect"===e?Array.isArray(s)?(0,a.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,a.jsxs)("label",{className:"checkbox-label block","data-checked":(null==l?void 0:l.includes(e.value))||!1,children:[(0,a.jsx)("input",{type:"checkbox",value:e.value,checked:(null==l?void 0:l.includes(e.value))||!1,onChange:d}),(0,a.jsx)("span",{children:e.text})]},e.value))}):(0,a.jsx)("div",{className:"text-red-500",children:"Error: Multi-select options not available."}):null})()}),(0,a.jsxs)("div",{className:"notes-area",children:[(0,a.jsx)("label",{htmlFor:"notes",className:"block text-sm font-semibold text-slate-700 mb-1",children:"Notes/Considerations (Optional):"}),(0,a.jsx)("textarea",{id:"notes",placeholder:"Enter any specific notes or justifications...",value:(null==o?void 0:o.notes)||"",onChange:e=>{s(t.id,{answer:null==o?void 0:o.answer,notes:e.target.value})},rows:"4"})]})]}):(0,a.jsx)("p",{children:"Loading question..."})}),(0,a.jsx)("div",{className:"layout-sidebar",children:t&&(0,a.jsxs)("div",{className:"question-explanation sticky top-8",children:[(0,a.jsx)("h4",{className:"font-bold text-slate-700 mb-2",children:"Why this is important"}),(0,a.jsx)("p",{children:t.explanation})]})})]}),(0,a.jsxs)("div",{className:"navigation-buttons",children:[(0,a.jsx)("button",{onClick:n,disabled:i,style:{visibility:i?"hidden":"visible"},children:"Previous"}),(0,a.jsx)("button",{onClick:l,className:r?"btn-finish":"",children:r?"Finish & View Results":"Next"})]})]})};var p=s(1047),b=s(1134);function j(e){let{results:t,onGoBack:s,questions:n,answers:i}=e,[r,o]=(0,l.useState)(!1),[c,d]=(0,l.useState)(""),[m,u]=(0,l.useState)(""),[h,x]=(0,l.useState)(""),[p,j]=(0,l.useState)(""),[g,v]=(0,l.useState)({status:"idle",message:""});if(!t)return(0,a.jsx)("div",{className:"app-container text-center",children:"Calculating results..."});t.potentialFailures.filter(e=>e.id.startsWith("1.")||e.id.startsWith("2.")),t.chartData.bar.labels.slice(0,2),t.chartData.bar.datasets.map(e=>({...e,data:e.data.slice(0,2)}));let N=async e=>{e.preventDefault(),v({status:"loading",message:""});try{let e=await fetch("/api/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:c,firm:p,email:m,phone:h,questions:n,answers:i})});if(!e.ok){let t=await e.json();throw Error(t.message||"Submission failed")}v({status:"success",message:"Thank you! Your full report is unlocked below and a copy has been sent to your email."}),o(!0)}catch(e){v({status:"error",message:e.message||"Something went wrong. Please try again."})}};return(0,a.jsxs)("div",{className:"app-container",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-indigo-700 mb-6 text-center",children:"Compliance Summary"}),(0,a.jsxs)("div",{className:"text-center p-6 bg-indigo-50 rounded-lg mb-10",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-indigo-700 mb-2",children:"Overall Compliance Health"}),(0,a.jsx)("div",{className:"w-full max-w-xs mx-auto h-48",children:(0,a.jsx)(b.nu,{data:{labels:["Compliant","Issues/Unanswered"],datasets:[{data:t.chartData.doughnut,backgroundColor:["#10b981","#ef4444"],borderWidth:4}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"70%",plugins:{legend:{display:!1}}}})}),(0,a.jsxs)("p",{className:"text-4xl font-bold mt-4 text-green-600",children:[t.healthScore,"%"]})]}),r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-10",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-indigo-700 mb-4",children:"Full Report: Potential Failures"}),t.potentialFailures.length>0?t.potentialFailures.map(e=>(0,a.jsxs)("div",{className:"potential-failure-item",children:[(0,a.jsxs)("p",{className:"font-semibold text-slate-800",children:[e.id,": ",e.question]}),e.notes&&(0,a.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:(0,a.jsxs)("em",{children:["Your Notes: ",e.notes]})}),(0,a.jsxs)("div",{className:"mt-2 text-sm p-2 rounded bg-red-100 border border-red-200",children:[(0,a.jsx)("strong",{className:"text-red-800",children:"Potential Implication: "}),(0,a.jsx)("span",{className:"text-slate-700",children:e.implication})]})]},e.id)):(0,a.jsx)("p",{className:"text-green-700 bg-green-100 p-4 rounded-md",children:"No critical compliance issues were flagged in the full report."})]}),(0,a.jsxs)("div",{className:"mb-10",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-indigo-700 mb-4",children:"Full Report: Detailed Breakdown"}),(0,a.jsx)("div",{className:"chart-container",style:{height:"400px"},children:(0,a.jsx)(b.yP,{data:t.chartData.bar,options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{stacked:!0},y:{stacked:!0}},plugins:{title:{display:!0,text:"Responses by Section",font:{size:16}},legend:{position:"top"}}}})})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:()=>{let e="data:text/csv;charset=utf-8,";e+="Question,Regulation Reference,Your Answer,Your Notes\r\n",n.forEach(t=>{t.items.forEach(t=>{let s=i[t.id],a=e=>e?'"'.concat(String(e).replace(/"/g,'""'),'"'):'""',l=(null==s?void 0:s.answer)?JSON.stringify(s.answer).replace(/"/g,""):"N/A",n=[a(t.questionText),a(t.questionRef),a(l),a((null==s?void 0:s.notes)||"")].join(",");e+=n+"\r\n"})});let t=encodeURI(e),s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download","mema_compliance_report.csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s)},className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg",children:"Download Full Report as CSV"})})]}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{id:"export-contact-section",className:"export-contact-form",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-indigo-700 mb-2 text-center",children:"Unlock & Download Full Report"}),(0,a.jsx)("p",{className:"text-slate-600 text-sm mb-4 text-center",children:"Provide your details to view the full report and receive a copy by email."}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"user-name",className:"block text-sm font-medium text-slate-700",children:"Full Name"}),(0,a.jsx)("input",{id:"user-name",type:"text",name:"name",placeholder:"Jane Doe",required:!0,className:"w-full p-2 border border-slate-300 rounded-md",value:c,onChange:e=>d(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"user-firm",className:"block text-sm font-medium text-slate-700",children:"Firm Name"}),(0,a.jsx)("input",{id:"user-firm",type:"text",name:"firm",placeholder:"Your Company Ltd",required:!0,className:"w-full p-2 border border-slate-300 rounded-md",value:p,onChange:e=>j(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"user-email",className:"block text-sm font-medium text-slate-700",children:"Email Address"}),(0,a.jsx)("input",{id:"user-email",type:"email",name:"email",placeholder:"you@company.com",required:!0,className:"w-full p-2 border border-slate-300 rounded-md",value:m,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"user-phone",className:"block text-sm font-medium text-slate-700",children:"Contact Number (Optional)"}),(0,a.jsx)("input",{id:"user-phone",type:"tel",name:"phone",placeholder:"07123 456789",className:"w-full p-2 border border-slate-300 rounded-md",value:h,onChange:e=>x(e.target.value)})]}),(0,a.jsx)("button",{type:"submit",disabled:"loading"===g.status,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg",children:"loading"===g.status?"Submitting...":"Unlock Full Report"})]}),"success"===g.status&&(0,a.jsx)("p",{className:"text-green-600 text-center mt-2",children:g.message}),"error"===g.status&&(0,a.jsx)("p",{className:"text-red-500 text-center mt-2",children:g.message})]})}),(0,a.jsx)("div",{className:"text-center mt-8",children:(0,a.jsx)("button",{onClick:s,className:"bg-slate-500 hover:bg-slate-600 text-white font-semibold py-2 px-4 rounded-lg",children:"â† Back to Questionnaire"})})]})}p.t1.register(p.Bs,p.m_,p.s$,p.PP,p.kc,p.E8,p.hE);var g=s(8692),v=s(9694),N=s(9257),f=s(3532),w=s(4396),y=s(4826);let k={1:g.A,2:v.A,3:N.A,4:f.A,5:w.A,6:y.A},A=e=>{let{sections:t,currentSectionId:s,completedSections:l,onStepClick:n}=e,i=l||[];return(0,a.jsx)("nav",{"aria-label":"Progress",children:(0,a.jsx)("ol",{role:"list",className:"stepper",children:t.map(e=>{let t=k[e.id.split(".")[0]],l=i.includes(e.id),r=e.id===s;return(0,a.jsxs)("li",{className:"step ".concat(l?"completed":r?"active":""),onClick:()=>n(e.id),children:[(0,a.jsx)("div",{className:"dot",children:t&&(0,a.jsx)(t,{className:"icon","aria-hidden":"true"})}),(0,a.jsx)("span",{className:"label",children:e.title})]},e.title)})})})};var C=s(6915);function S(){var e;let[t,s]=(0,l.useState)("welcome"),[n,r]=(0,l.useState)([]),[c,d]=(0,l.useState)({}),[m,u]=(0,l.useState)(0),[p,b]=(0,l.useState)(0),[k,S]=(0,l.useState)(null),[q,F]=(0,l.useState)({});(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/questions");if(!e.ok)throw Error("Failed to fetch questions");let t=await e.json();r(t)}catch(e){console.error("Error fetching questions:",e)}})()},[]);let E=e=>{let t={};for(let s=0;s<e;s++){let e=n[s].id;e&&(t[e]=!0)}F(t)},R=e=>{var t;(q[null==(t=n[e])?void 0:t.id]||e<=m)&&(u(e),b(0),E(e))},I=()=>{let e={};n.forEach(t=>{e[t.id]=!0}),F(e),S(P()),s("results")},P=()=>{let e=[],t=0,s=0,a=n.map(a=>{let l=0,n=0,i=0,r=0;return a.items.forEach(a=>{var o,d;let m=null==(o=c[a.id])?void 0:o.answer,u=!1,h="";if(m&&s++,"yesno"===a.type)"Yes"===m?(t++,l++):"No"===m?(n++,a.complianceImplicationIfNo&&(u=!0,h=a.complianceImplicationIfNo)):r++;else if("dropdown"===a.type||"multiselect"===a.type){let e=Array.isArray(m)?m:[m],s=!1;a.complianceImplicationIfSelected&&e.forEach(e=>{a.complianceImplicationIfSelected[e]&&(s=!0,h=a.complianceImplicationIfSelected[e])}),s?(u=!0,n++):m?(t++,i++):r++}u&&e.push({id:a.id,question:a.questionText,ref:a.questionRef,implication:h,notes:(null==(d=c[a.id])?void 0:d.notes)||""})}),{title:a.sectionTitle.replace(/Section \d+: /g,""),counts:[l,n,i,r]}}),l=s>0?Math.round(t/s*100):0,i={doughnut:[l,100-l],bar:{labels:a.map(e=>e.title),datasets:[{label:"Yes",data:a.map(e=>e.counts[0]),backgroundColor:"rgba(56, 189, 123, 0.7)"},{label:"No / Issue",data:a.map(e=>e.counts[1]),backgroundColor:"rgba(239, 68, 68, 0.7)"},{label:"Other",data:a.map(e=>e.counts[2]),backgroundColor:"rgba(99, 102, 241, 0.7)"},{label:"Unanswered",data:a.map(e=>e.counts[3]),backgroundColor:"rgba(245, 158, 11, 0.7)"}]}};return{potentialFailures:e,healthScore:l,chartData:i}},_=n.map(e=>({id:e.id,title:e.sectionTitle})),T={1:f.A,2:g.A,3:v.A,4:N.A,5:w.A,6:y.A,results:C.A},D="results"===t?"results":null==(e=n[m])?void 0:e.id;return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-100 font-sans",children:[(0,a.jsx)(i(),{children:(0,a.jsx)("title",{children:"MEMA Financial Promotions App"})}),(0,a.jsx)("header",{className:"bg-white text-slate-800 p-4 shadow-md sticky top-0 z-50",children:(0,a.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(o(),{src:"/mema-logo.png",alt:"MEMA Consultants Logo",width:160,height:40,className:"object-contain"})}),"questionnaire"===t&&(0,a.jsx)("button",{onClick:I,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition",children:"View Results"})]})}),(0,a.jsxs)("main",{children:["questionnaire"===t&&n.length>0&&(0,a.jsx)("div",{className:"container mx-auto px-4 mt-6",children:(0,a.jsx)(A,{sections:_,currentSectionId:D,completedSections:Object.keys(q),onStepClick:e=>R(e),iconMap:T})}),"welcome"===t&&(0,a.jsx)(h,{onStart:()=>s("questionnaire")}),"questionnaire"===t&&n.length>0?(0,a.jsx)(x,{section:n[m],question:n[m].items[p],onAnswer:(e,t)=>{d(s=>({...s,[e]:t}))},onNext:()=>{if(p<n[m].items.length-1)b(e=>e+1);else if(m<n.length-1){let e=m+1;u(e),b(0),E(e)}else I()},onPrev:()=>{if(p>0)b(e=>e-1);else if(m>0){let e=m-1;u(e),b(n[e].items.length-1),E(e)}},isFirstQuestion:0===m&&0===p,isLastQuestion:m===n.length-1&&p===n[m].items.length-1,currentAnswer:c[n[m].items[p].id]}):"questionnaire"===t?(0,a.jsx)("div",{className:"app-container text-center",children:"Loading questions..."}):null,"results"===t&&(0,a.jsx)(j,{results:k,onGoBack:()=>{s("questionnaire"),E(m)},questions:n,answers:c})]})]})}},2936:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(634)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[697,554,636,593,792],()=>t(2936)),_N_E=e.O()}]);