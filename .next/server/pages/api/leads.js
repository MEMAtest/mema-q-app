"use strict";(()=>{var e={};e.id=68,e.ids=[68],e.modules={2316:(e,t,n)=>{n.d(t,{A:()=>r});let r=new(require("@prisma/client")).PrismaClient},3480:(e,t,n)=>{e.exports=n(5600)},4280:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{config:()=>c,default:()=>l,routeModule:()=>d});var a=n(3480),s=n(8667),o=n(6435),i=n(9704),u=e([i]);i=(u.then?(await u)():u)[0];let l=(0,o.M)(i,"default"),c=(0,o.M)(i,"config"),d=new a.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/leads",pathname:"/api/leads",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6373:e=>{e.exports=import("resend")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return n}});var n=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9704:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{default:()=>i});var a=n(2316),s=n(6373),o=e([s]);async function i(e,t){if(!process.env.RESEND_API_KEY)return console.error("CRITICAL: RESEND_API_KEY environment variable is not set."),t.status(500).json({message:"Server configuration error: Email service is not set up."});let n=new s.Resend(process.env.RESEND_API_KEY);if("POST"!==e.method)return t.setHeader("Allow",["POST"]),t.status(405).json({message:`Method ${e.method} Not Allowed`});let{email:r,phone:o,firm:i,questions:u,answers:l}=e.body;if(!r||!o)return t.status(400).json({message:"Email and phone are required."});try{let e=await a.A.lead.create({data:{email:r,phone:o,firm:i}});await n.emails.send({from:"MEMA App <onboarding@resend.dev>",to:"contact@memaconsultants.com",subject:"New MEMA FinProms Questionnaire Lead",html:"..."});let s=function(e,t){if(!e||!t)return"";let n=[];return e.forEach(e=>{e.items.forEach(e=>{let r=t[e.id],a=r?.answer?JSON.stringify(r.answer).replace(/"/g,""):"N/A",s=r?.notes||"",o=[`"${e.questionText.replace(/"/g,'""')}"`,`"${e.questionRef.replace(/"/g,'""')}"`,`"${a.replace(/"/g,'""')}"`,`"${s.replace(/"/g,'""')}"`];n.push(o.join(","))})}),["Question,Regulation Reference,Your Answer,Your Notes",...n].join("\n")}(u,l),c=Buffer.from(s,"utf-8");return await n.emails.send({from:"MEMA Consultants <onboarding@resend.dev>",to:r,subject:"Your MEMA Financial Promotions Compliance Report",html:"...",attachments:[{filename:"MEMA_Compliance_Report.csv",content:c}]}),t.status(201).json({message:"Lead saved and emails sent.",lead:e})}catch(n){console.error("Error during lead submission:",n);let e=n.message||"An internal server error occurred.";return t.status(500).json({message:e})}}s=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=4280);module.exports=n})();